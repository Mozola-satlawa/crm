<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Konfigurator PRIMA — zestawy, komponenty, prowizje</title>
  <style>
    :root{
      --bg:#f6fff7; --panel:#fff; --line:#d9f5df; --text:#083c1c; --muted:#3e7a52;
      --accent:#22c55e; --accent-2:#16a34a; --accent-soft:#d9fbe5; --chip-bg:#eafcf1;
      --danger:#ef4444; --warn:#f59e0b; --ok:#10b981;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial;background:var(--bg);color:var(--text)}
    .wrap{max-width:1200px;margin:18px auto 48px;padding:0 16px}
    header{display:flex;gap:10px 16px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    h1{font-size:20px;margin:0} .sub{color:var(--muted);font-size:12px}
    .panel{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:14px;margin-top:12px}
    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:1100px){.grid{grid-template-columns:1.6fr .7fr}}
    label{font-size:12px;color:var(--muted);display:block;margin:0 0 6px}
    select,input[type="number"],input[type="text"]{width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--line);background:#fbfffc;color:var(--text);outline:none}
    select:focus,input:focus{border-color:var(--accent);box-shadow:0 0 0 3px var(--accent-soft)}
    .btn{background:var(--accent);color:#052e16;border:1px solid var(--accent-2);padding:9px 12px;border-radius:12px;font-weight:700;cursor:pointer}
    .btn.ghost{background:var(--chip-bg);border:1px dashed var(--line);color:var(--text)}
    .btn.danger{background:var(--danger);border-color:#b91c1c;color:#fff}
    .btn.warn{background:var(--warn);border-color:#b45309;color:#1f1300}
    .btn.ok{background:var(--ok);border-color:#047857;color:#052e16}
    .row{display:grid;grid-template-columns:repeat(12,1fr);gap:10px}
    .col{grid-column:span 12}
    @media(min-width:700px){.col{grid-column:span 4}.col.wide{grid-column:span 8}.col.full{grid-column:span 12}}
    table{width:100%;border-collapse:collapse;font-size:13px} th,td{padding:8px 10px;border-bottom:1px solid var(--line)}
    thead th{background:#f2fff5;text-align:left;position:sticky;top:0;z-index:1} tbody tr:nth-child(odd){background:#fcfffd}
    .right{text-align:right;white-space:nowrap} .nowrap{white-space:nowrap}
    .helperbar{position:sticky;top:8px;z-index:9;display:flex;gap:10px;align-items:center;flex-wrap:wrap;background:var(--panel);border:1px dashed var(--line);border-radius:12px;padding:8px 12px;margin:8px 0}
    .helperbar input[type="number"], .helperbar input[type="text"], .helperbar select{padding:8px 10px;border:1px solid var(--line);border-radius:10px}
    .chip{background:var(--chip-bg);border:1px solid var(--line);padding:4px 10px;border-radius:999px;font-weight:700;font-size:12px}
    .totals{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:8px}
    .totals .k{background:#f7fff8;padding:10px;border:1px dashed var(--line);border-radius:12px}
    .muted{color:var(--muted)}
    .note{font-size:12px;color:#0b3b21;background:#f0fff4;border:1px dashed var(--line);padding:8px;border-radius:10px}
    .error{color:#b91c1c;font-size:12px}
    .hide-on-print{display:initial}
    .only-print{display:none}
    @media print{.hide-on-print{display:none !important}.only-print{display:initial}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Konfigurator PRIMA (rozszerzony)</h1>
        <div class="sub">Zestawy PRIMA (6/8/10/12/16 kW), dobór komponentów (wymiennik, bufor, CWU, akcesoria), prowizja handlowca, VAT, zniżki i wydruk oferty. Działa offline.</div>
      </div>
      <div class="hide-on-print" style="display:flex; gap:8px; align-items:center;">
        <button class="btn ghost" id="btnSave">Zapisz</button>
        <button class="btn ghost" id="btnLoad">Wczytaj</button>
        <button class="btn" id="btnPrint">Drukuj/PDF</button>
      </div>
    </header>

    <div class="helperbar hide-on-print">
      <span class="chip">Moc: 6–16 kW • MONOBLOK/SPLIT</span>
      <label class="nowrap">VAT
        <select id="vat" style="width:120px; margin-left:6px;">
          <option value="0.08">8%</option>
          <option value="0.23">23%</option>
        </select>
      </label>
      <label class="nowrap">Prowizja handlowca
        <input id="prowizja" type="number" min="0" step="1" value="0" style="width:130px"/>
      </label>
      <label class="nowrap">Upust %
        <input id="discount" type="number" min="0" max="50" step="0.5" value="0" style="width:100px"/>
      </label>
      <label class="nowrap">Zapotrzebowanie [kW]
        <input id="qDemand" type="number" min="3" max="25" step="0.1" value="10" style="width:120px"/>
      </label>
      <button class="btn ok" id="btnSuggest">Zaproponuj zestaw</button>
    </div>

    <div class="grid">
      <div class="panel">
        <h3>Filtry i oferta</h3>
        <div class="row">
          <div class="col">
            <label>Rodzaj</label>
            <select id="rodzaj">
              <option value="">— wszystkie —</option>
              <option>MONOBLOK</option>
              <option>SPLIT</option>
            </select>
          </div>
          <div class="col">
            <label>Model (moc)</label>
            <select id="model">
              <option value="">— dowolny —</option>
              <option>6GT</option><option>8GT</option><option>10GT</option><option>12GT</option><option>16GT</option>
            </select>
          </div>
          <div class="col wide">
            <label>Szukaj</label>
            <input id="q" type="text" placeholder="np. Tower Grand, Complete 250/110, 200 l…" />
          </div>
        </div>

        <div class="list" style="margin-top:10px;">
          <table id="tbl">
            <thead>
              <tr>
                <th>Nr kat.</th>
                <th>Rodzaj</th>
                <th>Model</th>
                <th>Wymiennik</th>
                <th>Bufor</th>
                <th class="right">Netto [PLN]</th>
                <th></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div class="panel">
        <h3>Konfigurator komponentów</h3>
        <div class="row">
          <div class="col">
            <label>Jednostka podstawowa</label>
            <select id="cmpUnit"></select>
          </div>
          <div class="col">
            <label>Wymiennik</label>
            <select id="cmpHX"></select>
          </div>
          <div class="col">
            <label>Bufor</label>
            <select id="cmpBuffer"></select>
          </div>
          <div class="col">
            <label>Zbiornik CWU</label>
            <select id="cmpDHW"></select>
          </div>
          <div class="col wide">
            <label>Akcesoria</label>
            <select id="cmpAcc" multiple size="3" style="height:86px"></select>
          </div>
          <div class="col full hide-on-print">
            <span class="note">Kompatybilność: po wyborze jednostki filtruję dostępne wymienniki, bufory, CWU i akcesoria pod MONOBLOK/SPLIT oraz moc (np. 6–10 / 12–16).</span>
          </div>
          <div class="col full" style="display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
            <button class="btn" id="btnAddConfigured">Dodaj skonfigurowany zestaw</button>
            <button class="btn ghost" id="btnClearConfigured">Wyczyść</button>
          </div>
        </div>

        <h3 style="margin-top:12px">Koszyk</h3>
        <div class="list" style="margin-top: 10px;">
          <table id="basket">
            <thead>
              <tr>
                <th>Pozycja</th>
                <th>Ilość</th>
                <th class="right">Netto</th>
                <th class="right">Końcowa</th>
                <th class="row-btn"></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="totals" style="margin-top: 10px; grid-template-columns:repeat(3,1fr);">
          <div class="k"><div class="muted">Suma netto</div><div id="sumNetto" style="font-weight:800; font-size: 20px;">0,00</div></div>
          <div class="k"><div class="muted">Suma końcowa (z prowizją)</div><div id="sumFinal" style="font-weight:800; font-size: 22px;">0,00</div></div>
          <div class="k"><div class="muted">Brutto (z VAT)</div><div id="sumBrutto" style="font-weight:800; font-size: 22px;">0,00</div></div>
          <div class="k hide-on-print"><div class="muted">Prowizja handlowca</div><div id="sumProwizja" style="font-weight:800; font-size: 18px;">0,00</div></div>
          <div class="k hide-on-print"><div class="muted">Upust</div><div id="sumDiscount" style="font-weight:800; font-size: 18px;">0,00</div></div>
          <div class="k"><div class="muted">Uzasadnienie doboru</div><div id="autoNote" style="font-size:13px"></div></div>
        </div>
      </div>
    </div>

    <div class="panel only-print">
      <div class="muted">* Prowizja handlowca oraz linie pomocnicze nie są drukowane w pozycji szczegółowej — widoczne tylko w podsumowaniu.</div>
    </div>
  </div>

<script>
// ====== Dane bazowe (przykładowe; można rozszerzać) ======
const DATASETS = {
  sets: [
    // MONOBLOK Tower Grand 200 / bufor 60
    {nr:"SG-000044", rodzaj:"MONOBLOK", model:"6GT",  wym:"Tower Grand 200", bufor:"60",  netto:9104},
    {nr:"SG-000045", rodzaj:"MONOBLOK", model:"8GT",  wym:"Tower Grand 200", bufor:"60",  netto:9230},
    {nr:"SG-000046", rodzaj:"MONOBLOK", model:"10GT", wym:"Tower Grand 200", bufor:"60",  netto:9537},
    {nr:"SG-000054", rodzaj:"MONOBLOK", model:"12GT", wym:"Tower Grand 300", bufor:"60",  netto:11624},
    {nr:"SG-000056", rodzaj:"MONOBLOK", model:"16GT", wym:"Tower Grand 300", bufor:"60",  netto:12190},
    // MONOBLOK Complete 250/110
    {nr:"SG-000048", rodzaj:"MONOBLOK", model:"6GT",  wym:"Complete 250/110", bufor:"Complete 250/110", netto:9494},
    {nr:"SG-000050", rodzaj:"MONOBLOK", model:"10GT", wym:"Complete 250/110", bufor:"Complete 250/110", netto:9927},
    // SPLIT Tower Grand 200/300
    {nr:"SG-000061", rodzaj:"SPLIT",    model:"6GT",  wym:"Tower Grand 200", bufor:"60",  netto:9426},
    {nr:"SG-000063", rodzaj:"SPLIT",    model:"10GT", wym:"Tower Grand 200", bufor:"60",  netto:10018},
    {nr:"SG-000064", rodzaj:"SPLIT",    model:"12GT", wym:"Tower Grand 300", bufor:"60",  netto:11760},
    {nr:"SG-000066", rodzaj:"SPLIT",    model:"16GT", wym:"Tower Grand 300", bufor:"60",  netto:12212},
    // SPLIT Complete 250/110
    {nr:"SG-000068", rodzaj:"SPLIT",    model:"6GT",  wym:"Complete 250/110", bufor:"Complete 250/110", netto:9816},
    {nr:"SG-000070", rodzaj:"SPLIT",    model:"10GT", wym:"Complete 250/110", bufor:"Complete 250/110", netto:10408},
  ],
  units: [
    {id:"U-6-M",  name:"PRIMA 6GT MONOBLOK",  rodzaj:"MONOBLOK", moc:6,  netto:7200},
    {id:"U-8-M",  name:"PRIMA 8GT MONOBLOK",  rodzaj:"MONOBLOK", moc:8,  netto:7600},
    {id:"U-10-M", name:"PRIMA 10GT MONOBLOK", rodzaj:"MONOBLOK", moc:10, netto:8200},
    {id:"U-12-M", name:"PRIMA 12GT MONOBLOK", rodzaj:"MONOBLOK", moc:12, netto:9800},
    {id:"U-16-M", name:"PRIMA 16GT MONOBLOK", rodzaj:"MONOBLOK", moc:16, netto:10400},
    {id:"U-6-S",  name:"PRIMA 6GT SPLIT",     rodzaj:"SPLIT",    moc:6,  netto:7400},
    {id:"U-10-S", name:"PRIMA 10GT SPLIT",    rodzaj:"SPLIT",    moc:10, netto:8600},
    {id:"U-12-S", name:"PRIMA 12GT SPLIT",    rodzaj:"SPLIT",    moc:12, netto:9900},
    {id:"U-16-S", name:"PRIMA 16GT SPLIT",    rodzaj:"SPLIT",    moc:16, netto:10600},
  ],
  hx: [
    {id:"HX-TG200", name:"Tower Grand 200", rodzaj:"ALL", group:"6-10", netto:1500},
    {id:"HX-TG300", name:"Tower Grand 300", rodzaj:"ALL", group:"12-16", netto:1900},
    {id:"HX-C250",  name:"Complete 250/110", rodzaj:"ALL", group:"ALL", netto:2100},
  ],
  buffers: [
    {id:"B-60",  name:"Bufor 60 l", rodzaj:"ALL", group:"ALL", netto:700},
    {id:"B-C250", name:"Bufor Complete 250/110", rodzaj:"ALL", group:"ALL", netto:1950},
  ],
  dhw: [
    {id:"D-200", name:"Zbiornik CWU 200 l", rodzaj:"ALL", group:"6-10", netto:1800},
    {id:"D-300", name:"Zbiornik CWU 300 l", rodzaj:"ALL", group:"12-16", netto:2200},
  ],
  accessories: [
    {id:"A-WIFI", name:"Moduł Wi-Fi / zdalne sterowanie", rodzaj:"ALL", group:"ALL", netto:420},
    {id:"A-KZ3",  name:"Zawór mieszający 3-drogowy", rodzaj:"ALL", group:"ALL", netto:360},
    {id:"A-ANTY", name:"Zestaw antywibracyjny", rodzaj:"ALL", group:"ALL", netto:240},
  ]
};

// ====== Helpers ======
const PLN = n => (n||0).toLocaleString('pl-PL',{minimumFractionDigits:2,maximumFractionDigits:2});
const el = sel => document.querySelector(sel);
const els = sel => [...document.querySelectorAll(sel)];

function matchesGroup(unitMoc, group){
  if(!group || group==="ALL") return true;
  if(group==="6-10") return unitMoc>=6 && unitMoc<=10;
  if(group==="12-16") return unitMoc>=12 && unitMoc<=16;
  return true;
}

// ====== Lista gotowych zestawów ======
function filterSets(){
  const rodzaj = el('#rodzaj').value.trim();
  const model = el('#model').value.trim();
  const q = el('#q').value.trim().toLowerCase();
  return DATASETS.sets.filter(r => {
    if (rodzaj && r.rodzaj !== rodzaj) return false;
    if (model && r.model !== model) return false;
    const hay = (r.nr+' '+r.rodzaj+' '+r.model+' '+r.wym+' '+r.bufor).toLowerCase();
    return !q || hay.includes(q);
  });
}

function renderSetList(){
  const tb = el('#tbl tbody'); tb.innerHTML = '';
  const rows = filterSets();
  for (const r of rows){
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${r.nr}</td>
      <td>${r.rodzaj}</td>
      <td>PRIMA ${r.model}</td>
      <td>${r.wym}</td>
      <td>${r.bufor}</td>
      <td class="right">${PLN(r.netto)}</td>
      <td class="nowrap">
        <button class="btn ghost" data-act="cfg">Skonfiguruj</button>
        <button class="btn" data-act="add">Dodaj</button>
      </td>`;
    tr.querySelector('[data-act="add"]').addEventListener('click', ()=>addToBasket({nr:r.nr,name:`${r.rodzaj} PRIMA ${r.model} / ${r.wym} / ${r.bufor}`,netto:r.netto,qty:1}));
    tr.querySelector('[data-act="cfg"]').addEventListener('click', ()=>preloadConfigFromSet(r));
    tb.appendChild(tr);
  }
}

// ====== Konfigurator komponentów ======
function fillSelect(sel, items, placeholder='— wybierz —'){
  const s = el(sel); s.innerHTML = '';
  const opt0 = document.createElement('option'); opt0.value=''; opt0.textContent=placeholder; s.appendChild(opt0);
  for(const it of items){
    const o = document.createElement('option'); o.value = it.id||it.name; o.textContent = `${it.name||it.model||it.id} ${it.netto?('— '+PLN(it.netto)+' zł'):''}`; o.dataset.netto = it.netto||0; s.appendChild(o);
  }
}

function onUnitChange(){
  const unitId = el('#cmpUnit').value; const unit = DATASETS.units.find(u=>u.id===unitId);
  const hxOpts = DATASETS.hx.filter(h=> (h.rodzaj==='ALL' || h.rodzaj===unit.rodzaj) && matchesGroup(unit.moc,h.group));
  const bufOpts = DATASETS.buffers.filter(b=> (b.rodzaj==='ALL' || b.rodzaj===unit.rodzaj));
  const dhwOpts = DATASETS.dhw.filter(d=> (d.rodzaj==='ALL' || d.rodzaj===unit.rodzaj) && matchesGroup(unit.moc,d.group));
  const accOpts = DATASETS.accessories.filter(a=> (a.rodzaj==='ALL' || a.rodzaj===unit.rodzaj));
  fillSelect('#cmpHX', hxOpts);
  fillSelect('#cmpBuffer', bufOpts);
  fillSelect('#cmpDHW', dhwOpts);
  fillSelect('#cmpAcc', accOpts, '— wybierz (multi) —');
}

function preloadConfigFromSet(r){
  // Ustal jednostkę wg rodzaju + mocy w modelu
  const m = parseInt(r.model.replace(/[^0-9]/g,''),10);
  const unit = DATASETS.units.find(u=>u.rodzaj===r.rodzaj && u.moc===m);
  if(unit){ el('#cmpUnit').value = unit.id; onUnitChange(); }
  // Wymiennik, bufor
  const hx = DATASETS.hx.find(h=>h.name===r.wym); if(hx) el('#cmpHX').value = hx.id;
  const bf = DATASETS.buffers.find(b=>b.name.includes(r.bufor)); if(bf) el('#cmpBuffer').value = bf.id;
  // Dobierz CWU na grupę mocy jeśli pusta
  const dhwSel = el('#cmpDHW'); if(!dhwSel.value){
    const pick = [...dhwSel.options].find(o=>o.textContent.toLowerCase().includes(m>=12?'300':'200'));
    if(pick) dhwSel.value = pick.value;
  }
}

function addConfigured(){
  const unit = DATASETS.units.find(u=>u.id===el('#cmpUnit').value); if(!unit){ alert('Wybierz jednostkę.'); return; }
  const hx = DATASETS.hx.find(h=>h.id===el('#cmpHX').value);
  const bf = DATASETS.buffers.find(b=>b.id===el('#cmpBuffer').value);
  const dhw = DATASETS.dhw.find(d=>d.id===el('#cmpDHW').value);
  const accVals = [...el('#cmpAcc').selectedOptions].map(o=>o.value);
  const acc = DATASETS.accessories.filter(a=>accVals.includes(a.id));

  let name = `${unit.name}`;
  if(hx) name += ` / ${hx.name}`; if(bf) name += ` / ${bf.name}`; if(dhw) name += ` / ${dhw.name}`;
  for(const a of acc){ name += ` / ${a.name}`; }

  let netto = unit.netto + (hx?.netto||0) + (bf?.netto||0) + (dhw?.netto||0) + acc.reduce((s,a)=>s+a.netto,0);
  addToBasket({nr: `CFG-${Date.now()}`, name, netto, qty:1});
}

function clearConfigured(){
  ['#cmpUnit','#cmpHX','#cmpBuffer','#cmpDHW'].forEach(s=>{ el(s).value=''; });
  [...el('#cmpAcc').options].forEach(o=>o.selected=false);
}

// ====== Koszyk ======
const basket = [];
function addToBasket(item){
  const idx = basket.findIndex(x=>x.name===item.name);
  if (idx>=0){ basket[idx].qty += item.qty; }
  else { basket.push({...item}); }
  renderBasket();
}
function delFromBasket(nr){
  const i = basket.findIndex(x=>x.nr===nr); if(i>=0){ basket.splice(i,1); renderBasket(); }
}
function changeQty(nr, delta){
  const i = basket.findIndex(x=>x.nr===nr); if(i>=0){ basket[i].qty = Math.max(1, basket[i].qty + delta); renderBasket(); }
}

function computeTotals(){
  const vat = parseFloat(el('#vat').value||'0');
  const prow = parseFloat(el('#prowizja').value||'0');
  const disc = Math.max(0, Math.min(50, parseFloat(el('#discount').value||'0')));
  let sumNet=0;
  for(const p of basket){ sumNet += p.netto*p.qty; }
  const discountVal = sumNet * (disc/100);
  const sumAfterDisc = sumNet - discountVal;
  const sumFinal = sumAfterDisc + prow;
  const brutto = sumFinal * (1+vat);
  return {sumNet, discountVal, sumFinal, brutto, prow};
}

function renderBasket(){
  const tb = el('#basket tbody'); tb.innerHTML='';
  for (const p of basket){
    const line = p.netto*p.qty;
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${p.name}</td>
      <td>
        <button class="btn ghost" data-act="dec">−</button>
        <span style="padding:0 8px">${p.qty}</span>
        <button class="btn ghost" data-act="inc">+</button>
      </td>
      <td class="right">${PLN(line)}</td>
      <td class="right">${PLN(line)}</td>
      <td class="nowrap">
        <button class="btn danger" data-act="del">Usuń</button>
      </td>`;
    tr.querySelector('[data-act="dec"]').addEventListener('click', ()=>changeQty(p.nr,-1));
    tr.querySelector('[data-act="inc"]').addEventListener('click', ()=>changeQty(p.nr, 1));
    tr.querySelector('[data-act="del"]').addEventListener('click', ()=>delFromBasket(p.nr));
    tb.appendChild(tr);
  }
  const t = computeTotals();
  el('#sumNetto').textContent = PLN(t.sumNet);
  el('#sumDiscount').textContent = '− ' + PLN(t.discountVal);
  el('#sumFinal').textContent = PLN(t.sumFinal);
  el('#sumBrutto').textContent = PLN(t.brutto);
  el('#sumProwizja').textContent = PLN(t.prow);
}

// ====== Sugestia zestawu wg zapotrzebowania ======
function suggestByDemand(){
  const q = parseFloat(el('#qDemand').value||'10');
  let moc;
  if(q<=7) moc=6; else if(q<=9) moc=8; else if(q<=11) moc=10; else if(q<=14) moc=12; else moc=16;
  const rodz = el('#rodzaj').value||''; // respektuj filtr rodzaju jeśli ustawiony
  const sets = filterSets();
  const picked = sets.find(s=>parseInt(s.model.replace(/[^0-9]/g,''),10)===moc && (!rodz || s.rodzaj===rodz)) || sets.find(s=>parseInt(s.model.replace(/[^0-9]/g,''),10)===moc);
  let note = `Dobór wg zapotrzebowania ${q.toFixed(1)} kW → rekomendowana moc ${moc} kW.`;
  if(picked){
    note += ` Wybrano: ${picked.rodzaj} PRIMA ${picked.model} / ${picked.wym} / ${picked.bufor}.`;
    addToBasket({nr:picked.nr, name:`${picked.rodzaj} PRIMA ${picked.model} / ${picked.wym} / ${picked.bufor}`, netto:picked.netto, qty:1});
  } else {
    note += ' Brak dokładnego dopasowania — wybierz ręcznie.';
  }
  el('#autoNote').textContent = note;
}

// ====== Persist (localStorage) ======
function saveState(){
  const state = {
    vat: el('#vat').value,
    prow: el('#prowizja').value,
    disc: el('#discount').value,
    basket,
  };
  localStorage.setItem('prima_cfg', JSON.stringify(state));
  alert('Zapisano konfigurację.');
}
function loadState(){
  const raw = localStorage.getItem('prima_cfg');
  if(!raw){ alert('Brak zapisanej konfiguracji.'); return; }
  try{
    const s = JSON.parse(raw);
    el('#vat').value = s.vat||'0.08';
    el('#prowizja').value = s.prow||'0';
    el('#discount').value = s.disc||'0';
    basket.splice(0,basket.length, ...(s.basket||[]));
    renderBasket();
  }catch(e){ alert('Nie udało się wczytać konfiguracji.'); }
}

// ====== Init ======
function init(){
  // listy
  renderSetList();
  // konfigurator selects
  fillSelect('#cmpUnit', DATASETS.units);
  onUnitChange();
  el('#cmpUnit').addEventListener('change', onUnitChange);
  // filtry
  ['#rodzaj','#model','#q'].forEach(sel=>{
    el(sel).addEventListener('input', renderSetList);
    el(sel).addEventListener('change', renderSetList);
  });
  // koszyk & sterowanie
  ['#prowizja','#vat','#discount'].forEach(sel=>{
    el(sel).addEventListener('input', renderBasket);
    el(sel).addEventListener('change', renderBasket);
  });
  el('#btnSuggest').addEventListener('click', suggestByDemand);
  el('#btnAddConfigured').addEventListener('click', addConfigured);
  el('#btnClearConfigured').addEventListener('click', clearConfigured);
  el('#btnSave').addEventListener('click', saveState);
  el('#btnLoad').addEventListener('click', loadState);
  el('#btnPrint').addEventListener('click', ()=>window.print());
  renderBasket();
}

document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
