<!doctype html>
<html lang="pl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ARKON ‚Äî Wszystkie pliki i umowy</title>
<meta name="description" content="Jeden ekran: wzory dokument√≥w, pliki z Upload (IndexedDB) oraz umowy zapisane przy klient√≥w. PodglƒÖd PDF/IMG, pobieranie, wyszukiwanie, tagi.">
<style>
  :root{
    --bg:#0c0c0c; --panel:#121212; --card:#181818; --line:#2a2a2a;
    --ink:#f2f3f5; --muted:#b9c0cc; --accent:#3ea6ff; --ok:#2ecc71; --bad:#ff5c5c;
  }
  html,body{margin:0;height:100%}
  body{background:var(--bg);color:var(--ink);font:15px/1.55 system-ui,Segoe UI,Roboto,Arial}
  header{padding:16px;background:#0f0f0f;border-bottom:1px solid var(--line)}
  header h1{margin:0;font-size:22px}
  .small{font-size:12px;color:var(--muted)}
  nav{background:#141414;display:flex;gap:8px;flex-wrap:wrap;padding:10px 16px;border-bottom:1px solid var(--line);position:sticky;top:0;z-index:5}
  nav button{color:var(--ink);background:#1b1b1b;border:1px solid var(--line);padding:8px 12px;border-radius:8px;cursor:pointer}
  nav button.active{background:#202020;border-color:#3b3b3b}
  .wrap{max-width:1320px;margin:auto;padding:16px}
  .toolbar{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin:8px 0}
  .btn{background:#2a2a2a;border:1px solid #3b3b3b;color:#fff;border-radius:8px;padding:8px 12px;cursor:pointer}
  .btn.ghost{background:transparent;border-style:dashed;color:var(--accent)}
  .btn.ok{background:#173525;border-color:#2c7a52}
  .btn.bad{background:#351b1b;border-color:#613232}
  input,select,textarea{background:#111;border:1px solid #343434;border-radius:8px;padding:8px 10px;color:var(--ink);font:inherit}
  input::placeholder{color:#9aa3b3}
  .grid{display:grid;gap:16px}
  .cols-2{grid-template-columns:2fr 1fr}
  .card{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:14px}
  table{width:100%;border-collapse:collapse;border:1px solid var(--line);border-radius:10px;overflow:hidden}
  thead{background:#202020;position:sticky;top:0;z-index:1}
  th,td{padding:10px;border-bottom:1px solid var(--line);text-align:left;vertical-align:top}
  tbody tr:nth-child(odd){background:#151515}
  tbody tr:hover{background:#202020}
  .name{display:flex;gap:10px;align-items:center;min-width:240px}
  .ico{width:26px;height:26px;border-radius:6px;background:#222;display:grid;place-items:center;font-size:15px}
  .pdf{color:#ff6b6b}.doc{color:#63a6ff}.img{color:#f5d06f}.html{color:#9fe29f}
  .right{display:flex;gap:6px;justify-content:flex-end;flex-wrap:wrap}
  .pill{font-size:12px;color:var(--muted);border:1px solid #343434;border-radius:999px;padding:4px 10px}
  .tag{display:inline-block;margin:4px 6px 0 0;padding:4px 10px;border:1px solid #3c3c3c;border-radius:999px;font-size:12px;cursor:pointer}
  .tag:hover{background:#232323}
  .hint{font-size:12px;color:var(--muted)}
  .tabs{display:flex;gap:8px;margin:8px 0}
  .tabs button{border-radius:999px}
  .section{display:none}
  .section.active{display:block}
  /* modal */
  .modal{position:fixed;inset:0;background:#000c;display:none;align-items:center;justify-content:center;z-index:60}
  .modal.open{display:flex}
  .modal .box{width:1100px;max-width:95vw;max-height:92vh;background:#111;border:1px solid var(--line);border-radius:12px;display:flex;flex-direction:column}
  .modal .hd{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--line)}
  .modal .bd{padding:0;height:80vh}
  .modal iframe{width:100%;height:100%;border:0;background:#000}
  @media(min-width:1200px){ .cols-2{grid-template-columns:2fr 1fr} }
  @media print{ nav,.toolbar,.modal{display:none!important} }
</style>
</head>
<body>
<header>
  <h1>Wszystkie pliki i umowy ‚Ä¢ ARKON CRM</h1>
  <div class="small">Jedno miejsce: wzory dokument√≥w (FILES), pliki z Upload (IndexedDB) i umowy zapisane u klient√≥w. PodglƒÖd PDF/IMG/HTML, pobieranie, wyszukiwarka.</div>
</header>

<nav class="tabs" role="tablist">
  <button id="tabDocs" class="active" type="button">üìÅ Dokumenty (FILES)</button>
  <button id="tabUpload" type="button">‚¨ÜÔ∏è Upload (IndexedDB)</button>
  <button id="tabContracts" type="button">üßæ Umowy (z Klient√≥w)</button>
</nav>

<div class="wrap">
  <!-- Wsp√≥lna toolbar -->
  <div class="toolbar">
    <input id="q" placeholder="üîé Szukaj po nazwie/opisie/tagach‚Ä¶" style="min-width:280px" aria-label="Szukaj">
    <select id="fType" title="Typ pliku" aria-label="Typ">
      <option value="">Typ: wszystkie</option>
      <option value="pdf">PDF</option>
      <option value="doc">DOC/DOCX</option>
      <option value="img">IMG (jpg/png)</option>
      <option value="html">HTML</option>
    </select>
    <select id="sort" aria-label="Sortowanie">
      <option value="name.asc">Sort: nazwa ‚Üë</option>
      <option value="name.desc">Sort: nazwa ‚Üì</option>
      <option value="mod.desc">Sort: ostatnio modyfikowane</option>
    </select>
    <span class="pill">Widocznych: <b id="countVis">0</b></span>
    <div class="right" style="margin-left:auto">
      <button id="btnExportCSV" class="btn ghost" type="button">CSV (lista)</button>
      <button id="btnReloadUpload" class="btn ghost" type="button" title="Prze≈Çaduj listƒô z IndexedDB">Od≈õwie≈º Upload</button>
    </div>
  </div>

  <!-- Sekcja: Dokumenty (FILES) -->
  <section id="secDocs" class="section active">
    <div class="card">
      <table>
        <thead><tr><th>Nazwa</th><th>Opis</th><th>Tagi</th><th>Akcje</th></tr></thead>
        <tbody id="tbodyDocs"></tbody>
      </table>
      <div class="hint" style="margin-top:8px">Upewnij siƒô, ≈ºe pliki z href le≈ºƒÖ w tym samym katalogu co ta strona (lub zaktualizuj ≈õcie≈ºki).</div>
    </div>
  </section>

  <!-- Sekcja: Upload (IndexedDB) -->
  <section id="secUpload" class="section">
    <div class="card">
      <div class="right" style="margin-bottom:8px">
        <button id="btnAddFromUpload" class="btn ok" type="button">Za≈Çaduj z Upload</button>
      </div>
      <table>
        <thead><tr><th>Nazwa</th><th>Typ</th><th>≈πr√≥d≈Ço</th><th>Akcje</th></tr></thead>
        <tbody id="tbodyUpload"></tbody>
      </table>
      <div class="hint" style="margin-top:8px">≈πr√≥d≈Ço: IndexedDB <code>arkonCRM_local ‚Üí files</code>. PDF/IMG majƒÖ podglƒÖd, inne ‚Äî pobieranie.</div>
    </div>
  </section>

  <!-- Sekcja: Umowy (z Klient√≥w) -->
  <section id="secContracts" class="section">
    <div class="card">
      <table>
        <thead><tr><th>Nr / Data</th><th>Klient / Projekt</th><th>Warto≈õƒá</th><th>Akcje</th></tr></thead>
        <tbody id="tbodyContracts"></tbody>
      </table>
      <div class="hint" style="margin-top:8px">≈Åadowane z <code>localStorage['arkon_clients_v1']</code> (pole <code>contracts[]</code> przy kliencie).</div>
    </div>
  </section>
</div>

<!-- MODAL podglƒÖd -->
<div id="modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="mTitle">
  <div class="box">
    <div class="hd">
      <div id="mTitle"><b>PodglƒÖd</b></div>
      <div class="right">
        <a id="mOpen" class="btn ghost" href="#" target="_blank" rel="noopener">Otw√≥rz w nowej karcie</a>
        <button id="mClose" class="btn" type="button">Zamknij</button>
      </div>
    </div>
    <div class="bd"><iframe id="mFrame" src="about:blank" title="PodglƒÖd"></iframe></div>
  </div>
</div>

<script>
'use strict';
/* ===== helpers ===== */
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));
const fileExt = n => (n.split('.').pop()||'').toLowerCase();
const mimeToType = (name, mime='')=>{
  const n = (name||'').toLowerCase();
  if(mime.includes('pdf') || /\.pdf$/.test(n)) return 'pdf';
  if(mime.includes('image') || /\.(jpe?g|png|gif|webp)$/i.test(n)) return 'img';
  if(mime.includes('html') || /\.html?$/.test(n)) return 'html';
  if(mime.includes('word') || /\.(docx?|rtf)$/i.test(n)) return 'doc';
  return (fileExt(n) || 'file');
};
const icoChar = t => t==='pdf'?'üìÑ' : t==='doc'?'üìù' : t==='img'?'üñºÔ∏è' : t==='html'?'üåê' : 'üìÑ';
const clsByType = t => t==='pdf'?'pdf' : t==='doc'?'doc' : t==='img'?'img' : t==='html'?'html' : '';

/* ===== WSP√ìLNE UI ===== */
let activeTab = 'docs'; // 'docs' | 'upload' | 'contracts'
let filter = { q:'', type:'', sort:'name.asc' };

$('#tabDocs').onclick = ()=>switchTab('docs');
$('#tabUpload').onclick = ()=>switchTab('upload');
$('#tabContracts').onclick = ()=>switchTab('contracts');

function switchTab(key){
  activeTab = key;
  $$('#secDocs, #secUpload, #secContracts').forEach(el=>el.classList.remove('active'));
  if(key==='docs') $('#secDocs').classList.add('active');
  if(key==='upload') $('#secUpload').classList.add('active');
  if(key==='contracts') $('#secContracts').classList.add('active');
  $$('.tabs button').forEach(b=>b.classList.remove('active'));
  (key==='docs'?$('#tabDocs'):key==='upload'?$('#tabUpload'):$('#tabContracts')).classList.add('active');
  render();
}

$('#q').oninput = e=>{ filter.q = e.target.value; render(); };
$('#fType').onchange = e=>{ filter.type = e.target.value; render(); };
$('#sort').onchange = e=>{ filter.sort = e.target.value; render(); };
$('#btnExportCSV').onclick = exportCSV;

/* ===== MODAL ===== */
const modal = $('#modal'), mFrame = $('#mFrame'), mOpen = $('#mOpen'), mTitle = $('#mTitle');
$('#mClose').onclick = closePreview;
function openPreview(name, href, type){
  mTitle.textContent = name;
  mFrame.src = href;
  mOpen.href = href;
  modal.classList.add('open');
}
function closePreview(){ mFrame.src='about:blank'; modal.classList.remove('open'); }

/* ===== DOKUMENTY (FILES) ===== */
const FILES = [
  /* SZABLONY/EDYTOR ‚Äî HTML */
  { name:'Umowa modyfikowalna', href:'umowa2.html',
    desc:'Edytowalny szablon umowy (pe≈Çny tekst; zapis w localStorage; druk/PDF).', tags:['umowa','html'] },
  { name:'Umowa og√≥lna', href:'umowa_arkon_szablon.html',
    desc:'Szablon umowy ARKON (edycja + druk).', tags:['umowa','html'] },

  /* KLIENT ‚Äî ZA≈ÅƒÑCZNIKI */
  { name:'ANKIETA Audyt Energetyczny .docx',
    href:'ANKIETA Audyt Energetyczny .docx',
    desc:'Ankieta do audytu energetycznego (DOCX).',
    tags:['og√≥lne','audyt','doc'] },
  { name:'O≈öWIADCZENIE BENEFICJENTA ‚Äì wizja lokalna (audyt energetyczny).pdf',
    href:'OS√å WIADCZENIE BENEFICJENTA O PRZEPROWADZENIU WIZJI LOKALNEJ NIERUCHOMOS√å CI W CELU WYKONANIA AUDYTU ENERGETYCZNEGO BUDYNKU.pdf',
    desc:'O≈õwiadczenie beneficjenta o przeprowadzeniu wizji lokalnej (PDF).',
    tags:['og√≥lne','o≈õwiadczenie','audyt','pdf'] },

  /* üîß NAPRAWIONE: dok≈Çadna nazwa + en-dash ‚Äû‚Äì‚Äù */
  { name:'Umowa ARKON ‚Äì ocieplenie 2025.pdf',
    href:'Umowa ARKON ‚Äì ocieplenie 2025.pdf',
    desc:'Wz√≥r umowy ARKON ‚Äì ocieplenie (2025).',
    tags:['umowa','og√≥lne','pdf'] },

  { name:'Zdjƒôcie WhatsApp 2025-07-20.jpg',
    href:'Zdjƒôcie WhatsApp 2025-07-20 o 19.05.43_2df47b5f.jpg22.jpg',
    desc:'Zdjƒôcie z wizji lokalnej.',
    tags:['wizja','foto','img'] },

  /* OG√ìLNE */
  { name:'UMOWA Z WYKONAWCAÃ®  arkon.pdf',
    href:'UMOWA Z WYKONAWCAÃ®  arkon.pdf',
    desc:'Wz√≥r umowy z WykonawcƒÖ (PDF).',
    tags:['umowa','og√≥lne','prefinansowanie','dofinansowanie','pdf'] },
  { name:'PE≈ÅNOMOCNICTWO.docx',
    href:'PE≈ÅNOMOCNICTWO.docx',
    desc:'Pe≈Çnomocnictwo do reprezentowania w programie/urzƒôdzie.',
    tags:['pe≈Çnomocnictwo','og√≥lne','prefinansowanie','dofinansowanie','doc'] },
  { name:'OSÃÅWIADCZENIE WSPOÃÅ≈ÅMA≈ÅZÃáONKA.docx',
    href:'OSÃÅWIADCZENIE WSPOÃÅ≈ÅMA≈ÅZÃáONKA.docx',
    desc:'Zgoda wsp√≥≈Çma≈Ç≈ºonka.',
    tags:['o≈õwiadczenie','og√≥lne','doc'] },
  { name:'OSÃÅWIADCZENIE WSPOÃÅ≈ÅW≈ÅASÃÅCICIELA.docx',
    href:'OSÃÅWIADCZENIE WSPOÃÅ≈ÅW≈ÅASÃÅCICIELA.docx',
    desc:'Zgoda wsp√≥≈Çw≈Ça≈õciciela.',
    tags:['o≈õwiadczenie','og√≥lne','doc'] },
  { name:'7188a6a8-7977-4e81-8ce6-7410c21c9b25.pdf',
    href:'7188a6a8-7977-4e81-8ce6-7410c21c9b25.pdf',
    desc:'Dokument PDF (identyfikator).',
    tags:['og√≥lne','pdf'] },
  { name:'protokolu_odbioru_prac_wykonawcy.pdf',
    href:'protokolu_odbioru_prac_wykonawcy.pdf',
    desc:'Protok√≥≈Ç odbioru prac (PDF).',
    tags:['prefinansowanie','protok√≥≈Ç','pdf'] }
];

function renderDocs(){
  const tb = $('#tbodyDocs'); tb.innerHTML='';
  let rows = FILES.slice();
  rows = applyCommonFilters(rows.map(x=>({
    type: mimeToType(x.name,''), name:x.name, desc:x.desc||'', tags:x.tags||[], href: x.href
  })));
  rows.forEach(r=>{
    const tr = document.createElement('tr');
    const tdN = document.createElement('td');
    tdN.innerHTML = `<div class="name"><div class="ico ${clsByType(r.type)}">${icoChar(r.type)}</div><a href="${encodeURI(r.href)}" target="_blank" rel="noopener">${r.name}</a></div>`;
    const tdD = document.createElement('td'); tdD.textContent = r.desc||'';
    const tdT = document.createElement('td'); tdT.textContent = (r.tags||[]).join(', ');
    const tdA = document.createElement('td'); tdA.className='right';
    const btnOpen = document.createElement('a'); btnOpen.className='btn ghost'; btnOpen.textContent='Otw√≥rz'; btnOpen.href=encodeURI(r.href); btnOpen.target='_blank'; btnOpen.rel='noopener';
    if(r.type==='pdf' || r.type==='img' || r.type==='html'){ btnOpen.onclick=(e)=>{ e.preventDefault(); openPreview(r.name, encodeURI(r.href), r.type); }; }
    const btnDl = document.createElement('a'); btnDl.className='btn'; btnDl.textContent='Pobierz'; btnDl.href=encodeURI(r.href); btnDl.download=r.name;
    tdA.appendChild(btnOpen); tdA.appendChild(btnDl);
    tr.appendChild(tdN); tr.appendChild(tdD); tr.appendChild(tdT); tr.appendChild(tdA);
    tb.appendChild(tr);
  });
}

/* ===== UPLOAD (IndexedDB) ===== */
let db;
function dbOpen(){
  return new Promise((resolve,reject)=>{
    const r = indexedDB.open('arkonCRM_local', 2);
    r.onupgradeneeded = ()=>{ const d=r.result; if(!d.objectStoreNames.contains('files')) d.createObjectStore('files',{keyPath:'id'}); };
    r.onsuccess = ()=>{ db=r.result; resolve(); };
    r.onerror   = ()=>reject(r.error);
  });
}
async function dbListFiles(){
  await dbOpen();
  return new Promise((resolve,reject)=>{
    const out=[];
    const tx=db.transaction('files','readonly');
    const store=tx.objectStore('files');
    const req=store.openCursor();
    req.onsuccess = (e)=>{
      const cur=e.target.result;
      if(cur){ out.push(cur.value); cur.continue(); } else resolve(out);
    };
    req.onerror=()=>reject(req.error);
  });
}

async function loadUpload(){
  const tb = $('#tbodyUpload'); tb.innerHTML='';
  const list = await dbListFiles();
  let rows = list.map(f=>{
    const name = f.name || f.filename || f.originalName || 'plik';
    const type = mimeToType(name, (f.type||''));
    const href = f.blob ? URL.createObjectURL(f.blob) : '#';
    const src  = f.origin || 'Upload';
    return {name,type,href,src};
  });
  rows = applyCommonFilters(rows);
  rows.forEach(r=>{
    const tr = document.createElement('tr');
    const tdN = document.createElement('td');
    tdN.innerHTML = `<div class="name"><div class="ico ${clsByType(r.type)}">${icoChar(r.type)}</div>${r.name}</div>`;
    const tdT = document.createElement('td'); tdT.textContent = r.type.toUpperCase();
    const tdS = document.createElement('td'); tdS.textContent = r.src;
    const tdA = document.createElement('td'); tdA.className='right';
    const btnOpen = document.createElement('button'); btnOpen.className='btn ghost'; btnOpen.textContent='PodglƒÖd/Otw√≥rz';
    btnOpen.onclick = ()=> openPreview(r.name, r.href, r.type);
    const aDl = document.createElement('a'); aDl.className='btn'; aDl.textContent='Pobierz'; aDl.href=r.href; aDl.download=r.name;
    tdA.appendChild(btnOpen); tdA.appendChild(aDl);
    tr.appendChild(tdN); tr.appendChild(tdT); tr.appendChild(tdS); tr.appendChild(tdA);
    tb.appendChild(tr);
  });
}
$('#btnAddFromUpload').onclick = loadUpload;
$('#btnReloadUpload').onclick = loadUpload;

/* ===== UMOWY (z Klient√≥w) ===== */
function readClients(){
  try{ return JSON.parse(localStorage.getItem('arkon_clients_v1')||'[]') }catch{ return [] }
}
function renderContracts(){
  const tb = $('#tbodyContracts'); tb.innerHTML='';
  const clients = readClients();
  let rows = [];
  clients.forEach(c=>{
    (c.contracts||[]).forEach(k=>{
      rows.push({
        name: (k.no||'bez nr'),
        date: k.date||'',
        client: c.name||'',
        project: k.projectId || '',
        value: k.value || 0,
        html: k.html || '',
        savedAt: k.savedAt || 0
      });
    });
  });
  // map do wsp√≥lnego formatu
  rows = rows.map(r=>({
    type: 'html',
    name: `${r.name} / ${r.date||''}`,
    desc: r.client + (r.project ? ' ‚Äî ' + r.project : ''),
    tags: ['umowa'],
    href: r.html ? URL.createObjectURL(new Blob(['<!doctype html><meta charset="utf-8">' + r.html], {type:'text/html'})) : '#',
    value: r.value,
    savedAt: r.savedAt
  }));
  rows = applyCommonFilters(rows);
  rows.sort((a,b)=>{
    if(filter.sort==='mod.desc') return (b.savedAt||0)-(a.savedAt||0);
    return a.name.localeCompare(b.name,'pl',{sensitivity:'base'});
  });

  rows.forEach(r=>{
    const tr = document.createElement('tr');
    const tdNo = document.createElement('td');
    tdNo.innerHTML = `<div class="name"><div class="ico ${clsByType(r.type)}">${icoChar(r.type)}</div>${r.name}</div>`;
    const tdCli = document.createElement('td'); tdCli.textContent = r.desc;
    const tdVal = document.createElement('td'); tdVal.textContent = r.value ? (new Intl.NumberFormat('pl-PL',{maximumFractionDigits:0}).format(r.value)+' z≈Ç') : '‚Äî';
    const tdA = document.createElement('td'); tdA.className='right';
    const btnPrev = document.createElement('button'); btnPrev.className='btn ghost'; btnPrev.textContent='PodglƒÖd'; btnPrev.onclick=()=>openPreview(r.name, r.href,'html');
    const aDl = document.createElement('a'); aDl.className='btn'; aDl.textContent='Pobierz (HTML)'; aDl.href=r.href; aDl.download=(r.name.replace(/\s+/g,'_')+'.html');
    tdA.appendChild(btnPrev); tdA.appendChild(aDl);
    tr.appendChild(tdNo); tr.appendChild(tdCli); tr.appendChild(tdVal); tr.appendChild(tdA);
    $('#tbodyContracts').appendChild(tr);
  });
}

/* ===== WSP√ìLNE: filtrowanie/sort ===== */
function applyCommonFilters(rows){
  if(filter.q){
    const q = filter.q.toLowerCase();
    rows = rows.filter(r=>{
      const tags = (r.tags||[]).join(' ').toLowerCase();
      const desc = (r.desc||'').toLowerCase();
      return (r.name||'').toLowerCase().includes(q) || desc.includes(q) || tags.includes(q);
    });
  }
  if(filter.type){
    rows = rows.filter(r=>mimeToType(r.name).replace('file','') === filter.type || r.type===filter.type);
  }
  rows.sort((a,b)=>{
    switch(filter.sort){
      case 'name.asc':  return a.name.localeCompare(b.name,'pl',{sensitivity:'base'});
      case 'name.desc': return b.name.localeCompare(a.name,'pl',{sensitivity:'base'});
      case 'mod.desc':  return (b.savedAt||0)-(a.savedAt||0);
      default: return 0;
    }
  });
  $('#countVis').textContent = rows.length;
  return rows;
}

/* ===== eksport CSV ===== */
function exportCSV(){
  let rows=[];
  if(activeTab==='docs'){
    rows = FILES.map(x=>({name:x.name, desc:x.desc||'', tags:(x.tags||[]).join('|'), href:x.href, type:mimeToType(x.name)}));
  }else if(activeTab==='upload'){
    rows = Array.from($('#tbodyUpload').querySelectorAll('tr')).map(tr=>{
      const tds = tr.querySelectorAll('td');
      return { name: tds[0]?.innerText.trim(), desc:'', tags:'', href:'(blob:URL)', type:(tds[1]?.innerText.trim()||'').toLowerCase() };
    });
  }else{
    rows = Array.from($('#tbodyContracts').querySelectorAll('tr')).map(tr=>{
      const tds = tr.querySelectorAll('td');
      return { name: tds[0]?.innerText.trim(), desc: tds[1]?.innerText.trim(), tags:'umowa', href:'(blob:HTML)', type:'html' };
    });
  }
  const CSVesc = v => { let s=String(v==null?'':v); return /[";\n]/.test(s)?'"'+s.replace(/"/g,'""')+'"':s; };
  const out = [['Nazwa','Opis','Tagi','Typ','≈öcie≈ºka']];
  rows.forEach(r=>out.push([r.name,r.desc,r.tags,r.type,r.href]));
  const csv = out.map(line=>line.map(CSVesc).join(';')).join('\n');
  const blob = new Blob([csv], {type:'text/csv;charset=utf-8'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'arkon_wszystko.csv';
  a.click();
  URL.revokeObjectURL(a.href);
}

/* ===== init ===== */
function render(){
  if(activeTab==='docs') renderDocs();
  if(activeTab==='upload') {}
  if(activeTab==='contracts') renderContracts();
}
render();
</script>
</body>
</html>
